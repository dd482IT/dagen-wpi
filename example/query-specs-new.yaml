defaultSchema: drugs
generateUnqualifiedNamesForSchemas: ["drugs"]
querySpecs:
  - queryName: drugs query
    resultsRepresentations: [JSON_OBJECT_ROWS] # (<- the default, other options: JSON_ARRAY_ROW, MULTI_COLUMN_ROWS)
    generateResultTypes: true
    tableOutput:
      table: drug
      fieldsAndExpressions:
        - field: name
        - field: mesh_id
        - field: cid
          generateTypes:
            - language: Java
              typeDeclaration: Optional<Integer>
        - field: registered
        - field: market_entry_date
        - field: therapeutic_indications
        - expression: "$a : $a.cid + 1000"
          outputName: cidPlus1000
          generateTypes:
            - language: Java
              typeDeclaration: Optional<Integer>
      childCollections:
        - collectionName: references
          childTableOutput:
            table: drug_reference
            inlineParents:
              - parentTableOutput:
                  table: reference
                  fieldsAndExpressions:
                    - field: publication
        - collectionName: brands
          childTableOutput:
            table: brand
            fieldsAndExpressions:
              - field: brand_name
            inlineParents:
              - parentTableOutput:
                  table: manufacturer
                  fieldsAndExpressions:
                    - field: name
                      outputName: manufacturer
        - collectionName: advisories
          childTableOutput:
            table: advisory
            fieldsAndExpressions:
              - field: text
                outputName: advisoryText
            inlineParents:
              - parentTableOutput:
                  table: advisory_type
                  fieldsAndExpressions:
                    - field: name
                      outputName: advisoryType
                    - expression: "$a : (select 1 + 1)"
                      outputName: exprYieldingTwo
                      generateTypes:
                        - language: Java
                          typeDeclaration: long
                  inlineParents:
                    - parentTableOutput:
                        table: authority
                        fieldsAndExpressions:
                          - field: name
                            outputName: authorityName
                          - field: url
                            outputName: authorityUrl
                          - field: description
                            outputName: authorityDescription
        - collectionName: functionalCategories
          childTableOutput:
            table: drug_functional_category
            inlineParents:
              - parentTableOutput:
                  table: functional_category
                  fieldsAndExpressions:
                    - field: name
                      outputName: categoryName
                    - field: description
              - parentTableOutput:
                  table: authority
                  fieldsAndExpressions:
                    - field: name
                      outputName: authorityName
                    - field: url
                      outputName: authorityUrl
                    - field: description
                      outputName: authorityDescription
      referencedParents:
        - referenceFieldName: registeredByAnalyst
          parentTableOutput:
            table: analyst
            fieldsAndExpressions:
              - field: id
              - field: short_name
        - referenceFieldName: compound
          childForeignKeyFields:
            - compound_id
          parentTableOutput:
            table: compound
            fieldsAndExpressions:
              - field: display_name
              - field: nctr_isis_id
              - field: cas
              - field: entered
            referencedParents:
              - referenceFieldName: enteredByAnalyst
                parentTableOutput:
                  table: analyst
                  fieldsAndExpressions:
                    - field: id
                    - field: short_name
      fieldParamConditions:
        - fieldName: mesh_id
          op: IN
      condition: '$d : not $d.id = 2' # "<alias-var> : <expr using alias-var>", both sides trimmed

